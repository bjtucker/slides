---
com:
  ryezone:
    node:
      directories:
        - /etc/haproxy
        - /etc/keepalived
        - /etc/kubernetes
        - /etc/kubernetes/manifests
        - /etc/modules-load.d
        - /etc/sysctl.d
      conf_files:
        - template: etc/haproxy/haproxy.cfg.j2
          path: /etc/haproxy/haproxy.cfg
          mode: 644
        - template: etc/keepalived/check_apiserver.sh.j2
          path: /etc/keepalived/check_apiserver.sh
          mode: 755
        - template: etc/keepalived/keepalived.conf.j2
          path: /etc/keepalived/keepalived.conf
          mode: 644
        - template: etc/kubernetes/manifests/haproxy.yml.j2
          path: /etc/kubernetes/manifests/haproxy.yml
          mode: 644
        - template: etc/kubernetes/manifests/keepalived.yml.j2
          path: /etc/kubernetes/manifests/keepalived.yml
          mode: 644
        - template: etc/modules-load.d/crio.conf.j2
          path: /etc/modules-load.d/crio.conf
          mode: 644
        - template: etc/sysctl.d/99-kubernetes-cri.conf.j2
          path: /etc/sysctl.d/99-kubernetes-cri.conf
          mode: 644
    platform:
      zone: dev.ryezone.com
      k8s:
        kube_api_server:
          keepalived:
            state: backup
            interface: eth0
            router_id: 50
            priority: 101
            auth_pass: 42
            vip: 10.5.50.20
          haproxy:
            backend_servers:
              - controlplane01
              - controlplane02
              - controlplane03
            source_port: 6443
